<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Entrena Intervalos</title>
<style>
  :root{--blue:#0b63d4;--bg:#ffffff;--text:#0a2b4a}
  html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:var(--bg);color:var(--text)}
  .app{max-width:980px;margin:24px auto;padding:18px;border-radius:12px;box-shadow:0 6px 24px rgba(11,99,212,0.08)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{margin:0;font-size:20px;color:var(--blue)}
  .meta{display:flex;gap:12px;align-items:center}
  .chip{background:rgba(11,99,212,0.08);color:var(--blue);padding:6px 10px;border-radius:8px;font-weight:600}
  main{margin-top:16px}


  .staff-wrap{display:flex;gap:18px;align-items:center}
  svg.staff{background:linear-gradient(180deg,rgba(11,99,212,0.02),transparent);border-radius:8px}
  .controls{display:flex;flex-direction:column;gap:8px}
  .controls .big{font-size:18px;padding:8px 12px;border-radius:8px;background:var(--blue);color:#fff;border:none}

  .stats{display:flex;gap:12px;align-items:center;margin-top:12px}
  .stat{background:#f7f9ff;padding:8px 10px;border-radius:10px;color:var(--blue);font-weight:700}

  .answers{display:flex;flex-wrap:wrap;gap:8px;margin-top:14px}
  .answers button{flex:1 1 calc(50% - 8px);padding:10px;border-radius:8px;border:2px solid var(--blue);background:#fff;color:var(--blue);font-weight:700}
  .answers button.correct{background:var(--blue);color:#fff}
  .answers button.wrong{background:#ff6b6b;color:#fff;border-color:transparent}

  footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
  .small{font-size:13px;color:#395b8a}


  .modal{position:fixed;inset:0;background:rgba(2,18,43,0.45);display:flex;align-items:center;justify-content:center;padding:18px}
  .card{background:#fff;padding:18px;border-radius:12px;max-width:820px;width:100%;box-shadow:0 10px 40px rgba(2,18,43,0.25)}
  .examples{display:flex;gap:14px;flex-wrap:wrap;margin-top:12px}
  .example{flex:1 1 240px;border-radius:8px;border:1px solid rgba(11,99,212,0.08);padding:10px}
  .accept{margin-top:12px;display:flex;justify-content:flex-end}
  .btn-accept{background:var(--blue);color:#fff;padding:10px 14px;border-radius:8px;border:none;font-weight:700}

  
  .result{display:none;padding:18px;border-radius:12px;background:#fff;margin-top:12px;text-align:center}
  .result.show{display:block}
  .return-btn{margin-top:10px;background:#0a2b4a;color:#fff;padding:8px 14px;border-radius:8px;text-decoration:none;display:inline-block}

  @media(max-width:700px){.answers button{flex-basis:100%}}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Entrenador de intervalos</h1>
    <div class="meta">
      <div class="chip">Tiempo: <span id="timeChip">60</span>s</div>
      <div class="chip">Aciertos: <span id="goodChip">0</span></div>
      <div class="chip">Fallos: <span id="badChip">0</span></div>
    </div>
  </header>

  <main>
    <div class="staff-wrap">
      <svg class="staff" width="640" height="160" viewBox="0 0 640 160" aria-hidden>
      
        <g id="lines" stroke="#0b63d4" stroke-width="1">
          <line x1="80" y1="30" x2="600" y2="30" />
          <line x1="80" y1="48" x2="600" y2="48" />
          <line x1="80" y1="66" x2="600" y2="66" />
          <line x1="80" y1="84" x2="600" y2="84" />
          <line x1="80" y1="102" x2="600" y2="102" />
        </g>
        
        <text x="10" y="95" font-size="76" fill="#0b63d4">ùÑû</text>

     
        <g id="notes"></g>

        <g id="accs"></g>
     
         </svg>

      <div class="controls">
        <div class="small">Identifica el intervalo entre la nota base (izq) y la nota respuesta (derecha).</div>
        <div class="stats">
          <div class="stat">Intentos: <span id="attempts">0</span></div>
          <div class="stat">Correctas: <span id="correct">0</span></div>
          <div class="stat">Incorrectas: <span id="incorrect">0</span></div>
        </div>

        <div style="margin-top:8px;">
          <button id="nextBtn" class="big">Saltar / Nueva</button>
        </div>
      </div>
    </div>

    <div class="answers" id="answers"></div>

    <div class="result" id="resultBox">
      <h2>Tiempo terminado</h2>
      <p>Correctas: <strong id="resGood">0</strong></p>
      <p>Incorrectas: <strong id="resBad">0</strong></p>
      <p>Puntuaci√≥n: <strong id="resScore">0</strong></p>
      <a class="return-btn" href="principal.html">Volver a principal</a>
    </div>

    <footer>
      <div class="small">Notas mostradas sin etiqueta de octava (solo cabezas negras). Pueden incluir sostenidos (#).</div>
      <div class="small">Duraci√≥n por ronda: 60 s. ¬°Buena suerte!</div>
    </footer>
  </main>
</div>


<div class="modal" id="tutorial">
  <div class="card">
    <h2>Mini-tutorial: c√≥mo identificar intervalos</h2>
    <p>Te muestro ejemplos visuales (la nota izquierda es la base, la derecha es la comparada). Memoriza la distancia en nombres:</p>
    <div class="examples">
      <div class="example">
        <svg width="200" height="90" viewBox="0 0 200 90">
          <g stroke="#0b63d4" stroke-width="1"><line x1="10" y1="16" x2="190" y2="16"/><line x1="10" y1="28" x2="190" y2="28"/><line x1="10" y1="40" x2="190" y2="40"/><line x1="10" y1="52" x2="190" y2="52"/><line x1="10" y1="64" x2="190" y2="64"/></g>
          <text x="6" y="58" font-size="36" fill="#0b63d4">ùÑû</text>
         
          <circle cx="70" cy="48" r="7" fill="#000" />
          <circle cx="120" cy="48" r="7" fill="#000" />
        </svg>
        <div style="font-weight:700;margin-top:6px">Un√≠sono</div>
      </div>

      <div class="example">
        <svg width="200" height="90" viewBox="0 0 200 90">
          <g stroke="#0b63d4" stroke-width="1"><line x1="10" y1="16" x2="190" y2="16"/><line x1="10" y1="28" x2="190" y2="28"/><line x1="10" y1="40" x2="190" y2="40"/><line x1="10" y1="52" x2="190" y2="52"/><line x1="10" y1="64" x2="190" y2="64"/></g>
          <text x="6" y="58" font-size="36" fill="#0b63d4">ùÑû</text>
        
          <circle cx="70" cy="48" r="7" fill="#000" />
          <circle cx="120" cy="36" r="7" fill="#000" />
        </svg>
        <div style="font-weight:700;margin-top:6px">3¬™ Mayor</div>
      </div>

      <div class="example">
        <svg width="200" height="90" viewBox="0 0 200 90">
          <g stroke="#0b63d4" stroke-width="1"><line x1="10" y1="16" x2="190" y2="16"/><line x1="10" y1="28" x2="190" y2="28"/><line x1="10" y1="40" x2="190" y2="40"/><line x1="10" y1="52" x2="190" y2="52"/><line x1="10" y1="64" x2="190" y2="64"/></g>
          <text x="6" y="58" font-size="36" fill="#0b63d4">ùÑû</text>
          
          <circle cx="70" cy="48" r="7" fill="#000" />
          <circle cx="120" cy="20" r="7" fill="#000" />
        </svg>
        <div style="font-weight:700;margin-top:6px">5¬™ Justa</div>
      </div>

      <div class="example">
        <svg width="200" height="90" viewBox="0 0 200 90">
          <g stroke="#0b63d4" stroke-width="1"><line x1="10" y1="16" x2="190" y2="16"/><line x1="10" y1="28" x2="190" y2="28"/><line x1="10" y1="40" x2="190" y2="40"/><line x1="10" y1="52" x2="190" y2="52"/><line x1="10" y1="64" x2="190" y2="64"/></g>
          <text x="6" y="58" font-size="36" fill="#0b63d4">ùÑû</text>
          
          <circle cx="70" cy="48" r="7" fill="#000" />
          <circle cx="120" cy="28" r="7" fill="#000" />
        </svg>
        <div style="font-weight:700;margin-top:6px">Tritono</div>
      </div>
    </div>

    <div style="margin-top:8px">Cuando est√©s listo, presiona <strong>Aceptar</strong> y comienza la pr√°ctica de 60 segundos.</div>
    <div class="accept"><button id="acceptTutorial" class="btn-accept">Aceptar</button></div>
  </div>
</div>

<script>
(function(){
 
  const INTERVALS = [
    {name:'Un√≠sono', semitones:0},
    {name:'2¬™ Menor', semitones:1},
    {name:'2¬™ Mayor', semitones:2},
    {name:'3¬™ Menor', semitones:3},
    {name:'3¬™ Mayor', semitones:4},
    {name:'4¬™ Justa', semitones:5},
    {name:'Tritono', semitones:6},
    {name:'5¬™ Justa', semitones:7},
    {name:'6¬™ Menor', semitones:8},
    {name:'6¬™ Mayor', semitones:9},
    {name:'7¬™ Menor', semitones:10},
    {name:'7¬™ Mayor', semitones:11},
    {name:'Octava', semitones:12}
  ];

  const svgNotes = document.getElementById('notes');
  const accs = document.getElementById('accs');
  const answersDiv = document.getElementById('answers');
  const timeChip = document.getElementById('timeChip');
  const goodChip = document.getElementById('goodChip');
  const badChip = document.getElementById('badChip');
  const attemptsEl = document.getElementById('attempts');
  const correctEl = document.getElementById('correct');
  const incorrectEl = document.getElementById('incorrect');
  const resBox = document.getElementById('resultBox');
  const resGood = document.getElementById('resGood');
  const resBad = document.getElementById('resBad');
  const resScore = document.getElementById('resScore');
  const nextBtn = document.getElementById('nextBtn');

  let totalTime = 60; 
  let timer = null;
  let remaining = totalTime;
  let attempts = 0, correct = 0, incorrect = 0;
  let current = null; 

 
  function midiToY(m){
  
    const baseY = 84; 
   
    return baseY - (m - 64) * 4; 
  }

  function clearSVG(){ svgNotes.innerHTML=''; accs.innerHTML=''; }

  function drawNote(x,y,hasStem=true){
    const ns = document.createElementNS('http://www.w3.org/2000/svg','g');
    const circle = document.createElementNS('http://www.w3.org/2000/svg','ellipse');
    circle.setAttribute('cx',x);circle.setAttribute('cy',y);circle.setAttribute('rx',8);circle.setAttribute('ry',6);circle.setAttribute('fill','#000');
    ns.appendChild(circle);
    if(hasStem){
      const stem = document.createElementNS('http://www.w3.org/2000/svg','line');
      stem.setAttribute('x1',x+8);stem.setAttribute('y1',y);stem.setAttribute('x2',x+8);stem.setAttribute('y2',y-28);stem.setAttribute('stroke','#000');stem.setAttribute('stroke-width',2);
      ns.appendChild(stem);
    }
    svgNotes.appendChild(ns);
  }

  function maybeAccidental(x,y,sharp){
    if(sharp){
      const t = document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x',x-18);t.setAttribute('y',y+4);t.setAttribute('font-size',18);t.setAttribute('font-family','monospace');t.textContent='#';
      accs.appendChild(t);
    }
  }

  function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}

  function pickQuestion(){
   
    const base = randInt(64,74);
    
    const idx = Math.floor(Math.random()*INTERVALS.length);
    const sem = INTERVALS[idx].semitones;
    const directionUp = Math.random()<0.85; 
    const target = base + (directionUp?sem:-sem);
    current = {baseMidi:base, targetMidi:target, intervalIndex:idx};
    renderCurrent();
    populateOptions(idx);
  }

  function renderCurrent(){
    clearSVG();
    
    const baseY = midiToY(current.baseMidi);
    const targY = midiToY(current.targetMidi);
    drawNote(170,baseY,true);
    drawNote(330,targY,true);
    
    if(Math.random()<0.25) maybeAccidental(170,baseY,true);
    if(Math.random()<0.25) maybeAccidental(330,targY,true);
  }

  function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a }

  function populateOptions(correctIdx){
    answersDiv.innerHTML='';
   
    const choices = new Set([correctIdx]);
    while(choices.size<4) choices.add(randInt(0,INTERVALS.length-1));
    const arr = Array.from(choices).map(i=>({idx:i,label:INTERVALS[i].name}));
    shuffle(arr);
    arr.forEach(item=>{
      const btn = document.createElement('button');btn.textContent = item.label;
      btn.addEventListener('click',()=>handleAnswer(item.idx,btn));
      answersDiv.appendChild(btn);
    })
  }

  function handleAnswer(selectedIdx,btn){
    attempts++; attemptsEl.textContent=attempts;
    if(selectedIdx===current.intervalIndex){
      correct++; correctEl.textContent=correct; goodChip.textContent=correct;
      btn.classList.add('correct');
    } else {
      incorrect++; incorrectEl.textContent=incorrect; badChip.textContent=incorrect;
      btn.classList.add('wrong');
   
      Array.from(answersDiv.children).forEach(b=>{ if(b.textContent===INTERVALS[current.intervalIndex].name) b.classList.add('correct') });
    }
    
    Array.from(answersDiv.children).forEach(b=>b.disabled=true);
    
    setTimeout(()=>{ if(remaining>0) pickQuestion(); },550);
  }

 
  function startTimer(){
    remaining = totalTime; timeChip.textContent=remaining;
    timer = setInterval(()=>{
      remaining--; timeChip.textContent=remaining;
      if(remaining<=0){ clearInterval(timer); finishSession(); }
    },1000);
  }

  function finishSession(){
   
    resGood.textContent = correct; resBad.textContent = incorrect; resScore.textContent = Math.max(0, correct - incorrect);
    resBox.classList.add('show');
    
    Array.from(answersDiv.children).forEach(b=>b.disabled=true);
  }

  
  nextBtn.addEventListener('click',()=>{ if(remaining>0) pickQuestion(); });

  
  document.getElementById('acceptTutorial').addEventListener('click',()=>{
    document.getElementById('tutorial').style.display='none';
    
    pickQuestion();
    startTimer();
  });

 
  attemptsEl.textContent=0;correctEl.textContent=0;incorrectEl.textContent=0;goodChip.textContent=0;badChip.textContent=0;

})();
</script>
</body>
</html>
